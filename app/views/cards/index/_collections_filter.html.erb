<%= form_with url: cards_path, method: :get, class: "flex flex-column max-width popup__list",
      data: { controller: "form" } do |form| %>
  <% filter.as_params.except(:collection_ids).each do |key, value| %>
    <%= filter_hidden_field_tag key, value %>
  <% end %>

  <% Current.user.collections.order(:name).each do |collection| %>
    <div class="popup__group flex align-center">
      <div class="btn txt-xx-small flex-item-no-shrink">
        <%= form.check_box "collection_ids[]", {
              checked: filter.collections.include?(collection),
              data: { action: "change->form#submit" },
              include_hidden: false,
        }, collection.id %>

        <span class="for-screen-reader">
          Toggle filter for <%= collection.name %>
        </span>
        <%= icon_tag "check", size: 18, class: "checked" %>
      </div>

      <%= link_to cards_path(collection_ids: [ collection ]), class: "btn popup__item min-width" do %>
        <span class="overflow-ellipsis"><%= collection.name %></span>
      <% end %>
  
      <span class="translucent flex-item-no-shrink"> â€º</span>
    </div>
  <% end %>
<% end %>
